{"ast":null,"code":"import { PDFDocument } from 'pdf-lib';\nimport * as pdfjsLib from 'pdfjs-dist';\n\n// Set the worker source for PDF.js\npdfjsLib.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjsLib.version}/pdf.worker.min.js`;\n\n/**\n * Extract text from a PDF\n * @param {ArrayBuffer} pdfData - The PDF file data\n * @param {number} pageNumber - The page number to extract text from (1-indexed)\n * @returns {Promise<string>} The extracted text\n */\nconst extractTextFromPdf = async (pdfData, pageNumber) => {\n  try {\n    // Load the PDF document\n    const loadingTask = pdfjsLib.getDocument({\n      data: pdfData\n    });\n    const pdf = await loadingTask.promise;\n\n    // Get the specified page\n    const page = await pdf.getPage(pageNumber);\n\n    // Extract text content\n    const textContent = await page.getTextContent();\n\n    // Concatenate the text items\n    const text = textContent.items.map(item => item.str).join('\\n');\n    return text;\n  } catch (error) {\n    console.error(\"Error extracting text from PDF:\", error);\n    return \"\";\n  }\n};\n\n/**\n * Extract name and date from PDF text content\n * @param {string} text - The text content extracted from the PDF\n * @returns {Object} Object containing name and date\n */\nexport const extractNameAndDate = text => {\n  console.log(\"Full extracted text:\", text);\n\n  // Split text similar to Python version\n  const parts = text.split(\"4300\", 1);\n  const processText = parts.length > 1 ? parts[1] : text;\n\n  // Extract name using regex\n  const nameMatch = processText.match(/([A-Z][A-Za-z\\s]+)\\n/);\n  const name = nameMatch ? nameMatch[1].trim() : \"Unknown\";\n\n  // Extract date using regex\n  const dateMatch = processText.match(/Cheque Date:?\\s*(.*?)(?:\\n|$)/i);\n  let date = \"Unknown_Date\";\n  if (dateMatch) {\n    const dateStr = dateMatch[1].trim();\n    console.log(`Extracted date string: '${dateStr}'`);\n\n    // Try different date formats\n    const dateFormats = [{\n      regex: /(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})/,\n      format: m => `${m[3]}-${m[2].padStart(2, '0')}-${m[1].padStart(2, '0')}`\n    },\n    // dd/mm/yyyy\n    {\n      regex: /(\\d{1,2})-(\\d{1,2})-(\\d{4})/,\n      format: m => `${m[3]}-${m[2].padStart(2, '0')}-${m[1].padStart(2, '0')}`\n    },\n    // dd-mm-yyyy\n    {\n      regex: /(\\d{1,2})\\/(\\d{1,2})\\/(\\d{2})/,\n      format: m => `20${m[3]}-${m[2].padStart(2, '0')}-${m[1].padStart(2, '0')}`\n    },\n    // dd/mm/yy\n    {\n      regex: /(\\d{1,2})-(\\d{1,2})-(\\d{2})/,\n      format: m => `20${m[3]}-${m[2].padStart(2, '0')}-${m[1].padStart(2, '0')}`\n    },\n    // dd-mm-yy\n    {\n      regex: /(\\w+)\\s+(\\d{1,2}),\\s+(\\d{4})/,\n      format: m => {\n        const months = {\n          'January': '01',\n          'February': '02',\n          'March': '03',\n          'April': '04',\n          'May': '05',\n          'June': '06',\n          'July': '07',\n          'August': '08',\n          'September': '09',\n          'October': '10',\n          'November': '11',\n          'December': '12'\n        };\n        return `${m[3]}-${months[m[1]] || '01'}-${m[2].padStart(2, '0')}`;\n      }\n    } // Month dd, yyyy\n    ];\n    for (const format of dateFormats) {\n      const match = dateStr.match(format.regex);\n      if (match) {\n        date = format.format(match);\n        console.log(`Parsed date: ${date}`);\n        break;\n      }\n    }\n  } else {\n    console.log(\"No date found in the text\");\n  }\n  console.log(`Final result - Name: ${name}, Date: ${date}`);\n  return {\n    name,\n    date\n  };\n};\n\n/**\n * Split a PDF into individual pages and extract information\n * @param {ArrayBuffer} pdfData - The PDF file data\n * @returns {Promise<Array>} Array of objects with page data and extracted info\n */\nexport const splitPdf = async pdfData => {\n  try {\n    const pdfDoc = await PDFDocument.load(pdfData);\n    const pageCount = pdfDoc.getPageCount();\n    const results = [];\n    for (let i = 0; i < pageCount; i++) {\n      // Create a new document with just this page\n      const newPdf = await PDFDocument.create();\n      const [copiedPage] = await newPdf.copyPages(pdfDoc, [i]);\n      newPdf.addPage(copiedPage);\n\n      // Save the new PDF\n      const pdfBytes = await newPdf.save();\n\n      // Extract text from the page\n      const text = await extractTextFromPdf(pdfData, i + 1);\n\n      // Extract name and date\n      const {\n        name,\n        date\n      } = extractNameAndDate(text);\n      results.push({\n        pageNumber: i + 1,\n        name,\n        date,\n        filename: `${name} ${date}.pdf`,\n        pdfBytes\n      });\n    }\n    return results;\n  } catch (error) {\n    console.error(\"Error splitting PDF:\", error);\n    throw error;\n  }\n};","map":{"version":3,"names":["PDFDocument","pdfjsLib","GlobalWorkerOptions","workerSrc","version","extractTextFromPdf","pdfData","pageNumber","loadingTask","getDocument","data","pdf","promise","page","getPage","textContent","getTextContent","text","items","map","item","str","join","error","console","extractNameAndDate","log","parts","split","processText","length","nameMatch","match","name","trim","dateMatch","date","dateStr","dateFormats","regex","format","m","padStart","months","splitPdf","pdfDoc","load","pageCount","getPageCount","results","i","newPdf","create","copiedPage","copyPages","addPage","pdfBytes","save","push","filename"],"sources":["/Users/mattermost/Documents/paystub/paystub-web/src/utils/pdfProcessor.js"],"sourcesContent":["import { PDFDocument } from 'pdf-lib';\nimport * as pdfjsLib from 'pdfjs-dist';\n\n// Set the worker source for PDF.js\npdfjsLib.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjsLib.version}/pdf.worker.min.js`;\n\n/**\n * Extract text from a PDF\n * @param {ArrayBuffer} pdfData - The PDF file data\n * @param {number} pageNumber - The page number to extract text from (1-indexed)\n * @returns {Promise<string>} The extracted text\n */\nconst extractTextFromPdf = async (pdfData, pageNumber) => {\n  try {\n    // Load the PDF document\n    const loadingTask = pdfjsLib.getDocument({ data: pdfData });\n    const pdf = await loadingTask.promise;\n    \n    // Get the specified page\n    const page = await pdf.getPage(pageNumber);\n    \n    // Extract text content\n    const textContent = await page.getTextContent();\n    \n    // Concatenate the text items\n    const text = textContent.items.map(item => item.str).join('\\n');\n    \n    return text;\n  } catch (error) {\n    console.error(\"Error extracting text from PDF:\", error);\n    return \"\";\n  }\n};\n\n/**\n * Extract name and date from PDF text content\n * @param {string} text - The text content extracted from the PDF\n * @returns {Object} Object containing name and date\n */\nexport const extractNameAndDate = (text) => {\n  console.log(\"Full extracted text:\", text);\n  \n  // Split text similar to Python version\n  const parts = text.split(\"4300\", 1);\n  const processText = parts.length > 1 ? parts[1] : text;\n  \n  // Extract name using regex\n  const nameMatch = processText.match(/([A-Z][A-Za-z\\s]+)\\n/);\n  const name = nameMatch ? nameMatch[1].trim() : \"Unknown\";\n  \n  // Extract date using regex\n  const dateMatch = processText.match(/Cheque Date:?\\s*(.*?)(?:\\n|$)/i);\n  let date = \"Unknown_Date\";\n  \n  if (dateMatch) {\n    const dateStr = dateMatch[1].trim();\n    console.log(`Extracted date string: '${dateStr}'`);\n    \n    // Try different date formats\n    const dateFormats = [\n      { regex: /(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})/, format: (m) => `${m[3]}-${m[2].padStart(2, '0')}-${m[1].padStart(2, '0')}` }, // dd/mm/yyyy\n      { regex: /(\\d{1,2})-(\\d{1,2})-(\\d{4})/, format: (m) => `${m[3]}-${m[2].padStart(2, '0')}-${m[1].padStart(2, '0')}` }, // dd-mm-yyyy\n      { regex: /(\\d{1,2})\\/(\\d{1,2})\\/(\\d{2})/, format: (m) => `20${m[3]}-${m[2].padStart(2, '0')}-${m[1].padStart(2, '0')}` }, // dd/mm/yy\n      { regex: /(\\d{1,2})-(\\d{1,2})-(\\d{2})/, format: (m) => `20${m[3]}-${m[2].padStart(2, '0')}-${m[1].padStart(2, '0')}` }, // dd-mm-yy\n      { regex: /(\\w+)\\s+(\\d{1,2}),\\s+(\\d{4})/, format: (m) => {\n        const months = { 'January': '01', 'February': '02', 'March': '03', 'April': '04', 'May': '05', 'June': '06', \n                         'July': '07', 'August': '08', 'September': '09', 'October': '10', 'November': '11', 'December': '12' };\n        return `${m[3]}-${months[m[1]] || '01'}-${m[2].padStart(2, '0')}`;\n      }}, // Month dd, yyyy\n    ];\n    \n    for (const format of dateFormats) {\n      const match = dateStr.match(format.regex);\n      if (match) {\n        date = format.format(match);\n        console.log(`Parsed date: ${date}`);\n        break;\n      }\n    }\n  } else {\n    console.log(\"No date found in the text\");\n  }\n  \n  console.log(`Final result - Name: ${name}, Date: ${date}`);\n  return { name, date };\n};\n\n/**\n * Split a PDF into individual pages and extract information\n * @param {ArrayBuffer} pdfData - The PDF file data\n * @returns {Promise<Array>} Array of objects with page data and extracted info\n */\nexport const splitPdf = async (pdfData) => {\n  try {\n    const pdfDoc = await PDFDocument.load(pdfData);\n    const pageCount = pdfDoc.getPageCount();\n    const results = [];\n    \n    for (let i = 0; i < pageCount; i++) {\n      // Create a new document with just this page\n      const newPdf = await PDFDocument.create();\n      const [copiedPage] = await newPdf.copyPages(pdfDoc, [i]);\n      newPdf.addPage(copiedPage);\n      \n      // Save the new PDF\n      const pdfBytes = await newPdf.save();\n      \n      // Extract text from the page\n      const text = await extractTextFromPdf(pdfData, i + 1);\n      \n      // Extract name and date\n      const { name, date } = extractNameAndDate(text);\n      \n      results.push({\n        pageNumber: i + 1,\n        name,\n        date,\n        filename: `${name} ${date}.pdf`,\n        pdfBytes\n      });\n    }\n    \n    return results;\n  } catch (error) {\n    console.error(\"Error splitting PDF:\", error);\n    throw error;\n  }\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}